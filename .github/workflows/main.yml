name: API Add Reminder

on:
  workflow_dispatch:
    inputs:
      petName:
        description: "Pet name"
        required: true
      message:
        description: "Reminder message"
        required: true
      remindAt:
        description: "Time (YYYY-MM-DDTHH:MM)"
        required: true

jobs:
  add:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Add reminder
        run: |
          FILE="reminders.json"
          if [ ! -f "$FILE" ]; then echo "[]" > "$FILE"; fi

          jq --arg p "${{ github.event.inputs.petName }}" \
             --arg m "${{ github.event.inputs.message }}" \
             --arg t "${{ github.event.inputs.remindAt }}" \
             '. += [{"petName":$p,"message":$m,"remindAt":$t}]' \
             "$FILE" > tmp.json && mv tmp.json "$FILE"

      - name: Commit
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add reminders.json
          git commit -m "add reminder"
          git push
