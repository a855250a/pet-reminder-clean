- name: Send LINE reminders
  env:
    USER_ID: ${{ secrets.USER_ID }}
    TOKEN: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}
  run: |
    NOW=$(TZ=Asia/Taipei date +"%Y-%m-%d %H:%M")

    echo "Current time: $NOW"
    echo "CSV content:"
    cat reminders.csv

    tail -n +2 reminders.csv | while IFS=, read timestamp pet message time; do

      # ç§»é™¤å¯èƒ½çš„é›™å¼•è™Ÿ
      TIME=$(echo "$time" | tr -d '"')

      echo "Parsed time: $TIME"

      if [ "$TIME" = "$NOW" ]; then
        echo "Sending reminder: $pet $message"

        curl -s -X POST https://api.line.me/v2/bot/message/push \
          -H "Authorization: Bearer $TOKEN" \
          -H "Content-Type: application/json" \
          -d "{\"to\":\"$USER_ID\",\"messages\":[{\"type\":\"text\",\"text\":\"ğŸ¾ æé†’ä½ ï¼š$pet $message\"}]}"
      fi
    done
